# idseq-workflows tests

## WDL workflow & task tests

`make test` from the top-level `Makefile` invokes [pytest](https://docs.pytest.org/en/stable/) on this folder. The test suite for each workflow has two stages. First, the workflow is run end-to-end on one or more test inputs (using small reference databases) and its outputs sanity-checked. Second, task-level unit tests to exercise error paths or corner cases that aren't otherwise covered by the workflow tests. The workflow tests are triggered by session-scoped pytest fixtures which are then used by the task-level cases.

This two-stage structure allows the task unit tests to reuse intermediate inputs/outputs generated by the workflow tests, minimizing the boilerplate needed to express them. For example, `short-read-mngs/conftest.py` has the workflow test fixture for a small synthetic FASTQ pair ("bench3") to run using viral reference databases. Then, `short-read-mngs/host_filter/test_RunValidateInput.py` has unit tests for the RunValidateInput task to verify that it produces expected error messages, given the bench3 workflow inputs modified to pass an invalid FASTQ.
